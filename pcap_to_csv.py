#!/bin/bash

import os
import subprocess
import csv

for file in os.listdir():
    if file.endswith(".pcap"):
        command = f'tshark -r {file} -T fields -E header=y -E separator=, -E quote=d -E occurrence=f -e frame.len -e frame.protocols -e ip.len -e ip.flags -e ip.ttl -e ip.proto -e ip.src  -e ip.dst -e tcp.srcport -e tcp.dstport -e tcp.len -e tcp.hdr_len -e tcp.flags -e tcp.window_size_value -e tcp.window_size -e tcp.window_size_scalefactor -e tcp.time_relative -e tcp.time_delta -e tcp.analysis.bytes_in_flight -e tcp.analysis.push_bytes_sent > {file[:-5]}.csv'
        #process = subprocess.run([command])
        os.system(command)

#command = f'tshark -r {file} -T fields -E header=y -E separator=, -E quote=d -E occurrence=f -e frame.len -e frame.protocols -e ip.len -e ip.flags -e ip.ttl -e ip.proto -e ip.src  -e ip.dst -e tcp.srcport -e tcp.dstport -e tcp.len -e tcp.hdr_len -e tcp.flags -e tcp.window_size_value -e tcp.window_size -e tcp.window_size_scalefactor -e tcp.time_relative -e tcp.time_delta -e tcp.analysis.bytes_in_flight -e tcp.analysis.push_bytes_sent > {file[:-5]}.csv'

