import csv
import networkx as nx
import matplotlib.pyplot as plt
from tqdm import tqdm

#Create an empty network graph
G = nx.DiGraph()

#Read in csv
with open('mirai_mal_spread_all.csv') as csv_file:
    data = csv.reader(csv_file, delimiter=',')
    headers = next(data) #Skip header line
    for row in tqdm(data):
        if row[25] not in G:
            G.add_node(row[25])
        if row[26] not in G: 
            G.add_node(row[26])
        #G.add_node(row[25]) #IP SRC
        #G.add_node(row[26]) #IP DST
        if G.has_edge(row[25], row[26]):
            #Increase weight if edge exists
            G[row[25]][row[26]]['weight'] += 1
        else:
            G.add_edge(row[25], row[26], weight = 1)

#Node and edge count
G_nodes = G.number_of_nodes()
G_edges = G.number_of_edges()
print("Nodes = ", G_nodes, " Edges = ", G_edges)

nx.draw(G)
plt.savefig("spread2.png")

#nx.write_gexf(G, "graph.gexf")

#References
#https://towardsdatascience.com/from-csv-to-github-pages-in-5-steps-publishing-an-interactive-social-network-of-the-marvel-7b8374bf44fb

#If the sourc source and destination lready exist, dont add it. then add the edge. 
