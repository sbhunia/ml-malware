# Creates a dataset with 100,000 rows randomly selected from each csv
import os
import csv
import random

f = open('mod_combined_small.csv', 'w')

header = 'frame_len,frame_protocols,ip_len,ip_flags,ip_ttl,ip_proto,ip_src,ip_dst,tcp_srcport,tcp_dstport,tcp_len,tcp_hdr_len,tcp_flags,tcp_window_size_value,tcp_window_size,tcp_window_size_scalefactor,tcp_time_relative,tcp_time_delta,tcp_analysis_bytes_in_flight,tcp_analysis_push_bytes_sent,is_malware,malware_type,device,phase\n'

f.write(header)

for file in os.listdir():
    if file.endswith('csv') and file.find('combined') == -1:
        
        # open the file and skip the header
        print(f'Opening {file}')
        records = open(file)
        records.readline()

        # read all the data in temporarily
        tmp = records.readlines()
        records.close()
        
        # shuffle data to create randomness
        print(f'Shuffling {file}')
        random.shuffle(tmp)

        # if the file is the raspberry 1, max lines can be 46,000
        i = 1
        if file.find('rasp1') != -1:

            print(f'Getting 46,000 lines from {file}')
            
            for line in tmp:
                if i <= 46000:
                    f.write(line)
                    i += 1
                    continue
                else:
                    break
        
        # if the file is the raspberry 2, max lines can be 2,000
        elif file.find('rasp2') != -1:
            
            print(f'Getting 2,000 lines from {file}')
            
            for line in tmp:
                if i <= 2000:
                    f.write(line)
                    i += 1
                    continue
                else:
                    break
        else:
            
            print('Getting 100,000 lines from {file}')
            
            for line in tmp:
                if i <= 100000:
                    f.write(line)
                    i += 1
                    continue
                else:
                    break

        print(f'Wrapping Up {file}')

f.close()
